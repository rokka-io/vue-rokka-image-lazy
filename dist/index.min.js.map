{"version":3,"file":"index.min.js","sources":["../src/Img.vue","../src/index.js"],"sourcesContent":["<template>\n  <rokka-img\n    :org=\"org\"\n    :hash=\"hash\"\n    :filename=\"filename\"\n    :stack=\"stack\"\n    :format=\"format\"\n    :alt=\"alt\"\n    srcset-attribute=\"data-srcset\"\n    src-attribute=\"data-src\"\n    src-additional-attribute=\"src\"\n    :src-additional=\"srcAdditionalComputed\"\n    :postfix=\"postfix\"\n    :options=\"options\"\n  />\n</template>\n\n<script>\nimport { RokkaImg, rokkaUrl as buildRokkaUrl } from 'vue-rokka-image'\nimport lozad from 'lozad'\n\nclass ImageCache {\n  constructor({ max }) {\n    this.options = {\n      max: max || 100,\n    }\n    this._caches = []\n  }\n\n  has(key) {\n    return this._caches.indexOf(key) > -1\n  }\n\n  add(key) {\n    if (this.has(key)) return\n    this._caches.push(key)\n    if (this._caches.length > this.options.max) {\n      this.free()\n    }\n  }\n\n  free() {\n    this._caches.shift()\n  }\n}\n\nexport default {\n  name: 'RokkaImgLazy',\n  components: {\n    RokkaImg,\n  },\n  props: {\n    ...RokkaImg.props,\n    srcAttribute: {\n      type: String,\n      default: 'data-src',\n    },\n    srcsetAttribute: {\n      type: String,\n      default: 'data-srcset',\n    },\n    postfix: {\n      type: [Object, Array],\n      default: () => ['1x', '2x'],\n    },\n    options: {\n      type: [Object, Array],\n      default: () => [{}, { dpr: '2' }],\n    },\n    operations: {\n      type: [Object, Array],\n      default: () => [],\n    },\n    loading: {\n      type: String,\n      default: null,\n    },\n  },\n  computed: {\n    srcAdditionalComputed() {\n      if (!this.loading || this.isCached) {\n        return 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='\n      }\n      window._imageCache.add(this.rokkaRenderUrl)\n      return this.loading\n    },\n\n    isCached() {\n      return window._imageCache.has(this.rokkaRenderUrl)\n    },\n\n    rokkaRenderUrl() {\n      return buildRokkaUrl({\n        org: this.org,\n        hash: this.hash,\n        stack: this.stack,\n        format: this.format,\n        filename: this.filename,\n        options: Array.isArray(this.options) ? this.options[0] : this.options,\n        variables: Array.isArray(this.variables)\n          ? this.variables[0]\n          : this.variables,\n      })\n    },\n  },\n  created() {\n    if (!window._imageCache) {\n      window._imageCache = new ImageCache({ max: 200 })\n    }\n  },\n  updated() {\n    window._lozadObserver.observe()\n  },\n  mounted() {\n    // We initialize Lozad.js on the root\n    // element of our component.\n    if (!window._lozadObserver) {\n      window._lozadObserver = lozad('.rokka--attr-data-src', {\n        rootMargin: '200px',\n      })\n    }\n    window._lozadObserver.observe()\n  },\n}\n</script>\n\n<style scoped></style>\n","import RokkaImgLazy from './Img.vue'\n\nmodule.exports = {\n  RokkaImgLazy,\n  default: {\n    install(Vue) {\n      Vue.component('rokka-img-lazy', RokkaImgLazy)\n    },\n  },\n}\n"],"names":["exports","RokkaImgLazy","install","Vue","component"],"mappings":";;;;;k7EAEA,wwBCAOA,QAAU,CACfC,aAAAA,qBACS,CACPC,iBAAQC,GACNA,EAAIC,UAAU,iBAAkBH"}